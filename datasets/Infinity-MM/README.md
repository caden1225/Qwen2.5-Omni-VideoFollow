---
license: cc-by-sa-4.0
configs:
- config_name: stage1
  data_files:
  - split: train
    path: stage1/*/*
- config_name: stage2
  data_files:
  - split: train
    path: stage2/*/*/*
- config_name: stage3
  data_files:
  - split: train
    path: stage3/*/*
- config_name: stage4
  data_files:
  - split: train
    path: stage4/*/*/*
language:
- en
- zh
size_categories:
- 10M<n<100M
task_categories:
- image-to-text
extra_gated_prompt: "You agree to not use the dataset to conduct experiments that cause harm to human subjects."
extra_gated_fields:
  Company/Organization: text
  Country: country
---



## **Introduction**

<p align="center">
<img src="infinity-mm-logo.jpeg" width="300">
</p>
<p align="center">
<em>Beijing Academy of Artificial Intelligence (BAAI)</em><br/>
</p>

We collect, organize and open-source the large-scale multimodal instruction dataset, **Infinity-MM**, consisting of tens of millions of samples. Through quality filtering and deduplication, the dataset has high quality and diversity.
We propose a synthetic data generation method based on open-source models and labeling system, using detailed image annotations and diverse question generation.
Based on Infinity-MM, we have successfully trained a 2-billion-parameter VLM model, **Aquila-VL-2B**, achieving SOTA performance among models of the same scale.


## **News**
- `2024/11/19` We have released [**Aquila-VL-2B**](https://huggingface.co/BAAI/Aquila-VL-2B-llava-qwen/) and all [intermediate checkpoints](https://huggingface.co/BAAI/Aquila-VL-2B-Intermediate) obtained during different stages of training. Please feel free to use these models for analysis and experimentation.
- `2024/11/05` The data in stage2/7M_0712_math_plus_system_release_0802 was incomplete. We have now updated it, and the new data is placed in stage2/7M_0712_math_plus_system_release. Please replace the previous data with this updated version.
- `2024/10/28` All the data has been uploaded.
- `2024/10/24` The data of stage 2, stage 3 and stage 4 has been transferred. And the data of stage 1 will complete transmission next Friday(2024/11/1). 


## **Data Category of Infinity-MM Data**
| Data Folder | Data Category                     | Size  | Data Composition                                                                 |
|-------|------------------------------------|-------|----------------------------------------------------------------------------------|
|<div align="center">Stage 1| <div align="center">Image-Caption Data                 | <div align="center">10M</div>   | <div align="center">Caption Data 10M</div>                                          |
|<div align="center"><br><br>Stage 2| <div align="center"><br><br>General Visual Instruction Data    | <div align="center"><br><br>25.8M</div> | <div align="center">General Data 7.1M <br> General OCR Data 2.6M <br> Doc/Chart/Screen Data 5.8M <br> Math/Reasoning Data 1.3M <br> Text Instruct Data 9M</div> |
|<div align="center"><br>Stage 3| <div align="center"><br>Selective Visual Instruction Data  | <div align="center"><br>6M</div>    | <div align="center">LLaVA-onevision Data 3.5M <br> Infinity-Instruct 1.3M <br> Docmatix Data 1.2M</div> |
|<div align="center"><br>Stage 4| <div align="center"><br>GPT4 & Synthetic Data              | <div align="center"><br>3M</div>    | <div align="center">Data Generated by GPT4 1.7M <br> Synthetic Data 0.8M <br> Specific Task Data 0.4M <br>Infinity-Preference Data 0.1M</div> |

## **An example of the formated data**
```json
{"id": "10", 
 "source": "llava", 
 "conversations": [
 {
 "from": "human", 
 "value": "<image> Can you create a descriptive poem about the scene?"
 }, 
 {
 "from": "gpt", 
 "value": "Upon a plate of verdant hue,\nA cluster of roasted nuts we view.\nCashews golden, shining bright,\nAlmonds dark, a roasted delight.\nSprinkled seeds of sesame light,\nEnhancing flavors, a gentle bite.\nOn white wood they rest in grace,\nA rustic charm, a peaceful place.\nSimple joys in a vibrant array,\nA perfect treat to start the day."
 }], 
 "image": "/path/of/the/image", 
 "ram++_tags": ["wall", "dry", "grassy", "hill", "stone", "sun", "sunset"], 
 "ram++_tags_score": [9.56411075592041, 2.3733813762664795, 1.4329272508621216, 1.9840935468673706, 1.9766467809677124, 2.255882501602173, 2.575751781463623], 
 "phash": [12512305226191801180], 
 "qw2vl_loss": 3.0559005737304688
 }
```

The meaning of each key values:
* **'id'**: The id of the record.
* **'source'**: The source of the record.
* **'conversations'**: The conversations of the record.
* **'image'**: The absolute image path of the image.
* **'ram++_tags' & 'ram++_tags_score'**: These two values are obtained by [Ram++] model. 'ram++_tags' is the tags of the image, and the 'ram++_tags_score' is the score of tags of the image.
* **'phash'**: The phash value of the image.
* **'qw2vl_loss'**: The value is calculated from [Qwen2-VL-2B].



## How to use

You can download the dataset and then follow the steps below:
* **save the following code as 'revert_wds_shards.py'** 
```python
import json
import os
import time
import yaml
import glob
import webdataset as wds
from PIL import Image, ImageFile
import jsonlines
import copy

from tqdm import tqdm

if __name__ == "__main__":
  import argparse
  parser = argparse.ArgumentParser()
  parser.add_argument('--wds-path', type=str, default=None, help="file path", required=True)
  parser.add_argument('--output-path', type=str, default="", help="file path", required=True)
  parser.add_argument('--output-prefix', type=str, default="", help="file path", required=True)
  args = parser.parse_args()

  output = args.output_path
  if not os.path.exists(output):
      os.makedirs(output)
  else:
      print(f"Dir: {output} already existed.")

  tar_files = glob.glob(args.wds_path)
  if not tar_files:
    print(f"No files found matching the pattern: {args.wds_path}")
    exit(1)

  ## Allowed fields and Rename
  fields_mapping = dict()
  fields_mapping['id'] = 'id'
  fields_mapping['source'] = 'source'
  fields_mapping['conversations'] = 'conversations'
  fields_mapping['image'] = 'image'
  fields_mapping['tags'] = 'ram++_tags'
  fields_mapping['score'] = 'ram++_tags_score'
  fields_mapping['phash'] = 'phash'
  fields_mapping = {v: k for k, v in fields_mapping.items()}

  json_list = []
#   dataset = wds.WebDataset(args.wds_path)
  dataset = wds.WebDataset(tar_files)
  filtered = 0
  batch_size = 1000
  lines = 0
  for sample in tqdm(dataset):
    entry = copy.deepcopy(json.loads(sample['json']))
    if 'source' in entry:
      del entry['source']
    if 'ram++_tags' in entry:
      del entry['ram++_tags']
    if 'ram++_tags_score' in entry:
      del entry['ram++_tags_score']
    if 'phash' in entry:
      del entry['phash']

    img_data = sample['jpg']
    if img_data == bytes():
      pass
    else:
      file_name_without_ext, file_extension = os.path.splitext(entry['image'])
      img_filename = f"{sample['__key__']}{file_extension}"
      
      try:
        target_dir = os.path.join(output, f"{int(lines/batch_size):05d}")
        os.makedirs(target_dir, exist_ok=True)
        img_file = open(os.path.join(target_dir, img_filename), 'wb')
        img_file.write(img_data)
        img_file.close()

      except Exception as exn:
        print(exn)
        filtered += 1
        continue
      entry['image'] = os.path.join(os.path.abspath(target_dir), img_filename)
    json_list.append(entry)
    lines += 1
    # writer.write(entry)

  json_file = os.path.join(output, f"{args.output_prefix}.json")
  with open(json_file, 'w', encoding='utf-8') as f:
      json.dump(json_list, f, ensure_ascii=False, indent=4)
  print(f"Filtered {filtered} samples.", flush=True)
```
* **Then use the following command to get each subdataset:**
```python
export wds_path='/the/actual/path/of/each/dataset/*.tar'
export output_path='/the/path/you/want/to/save/the/dataset/'
export output_prefix='the json name of dataset you want to save'
python revert_wds_shards.py --wds-path "$wds_path" --output-path "$output_path" --output-prefix "$output_prefix"
```





## **Data Source of Infinity-MM Dataset**
| Data Source               | Size   |
|---------------------------|--------|
| <div align="center">Emu2                      | <div align="center">10M    |
| <div align="center">LVIS-Instruct              | <div align="center">223K   |
| <div align="center">LLaVA-CC3M-Pretrain-595K   | <div align="center">595K   |
| <div align="center">Visdial                   | <div align="center">116K   |
| <div align="center">Sharegpt4                 | <div align="center">3.2M   |
| <div align="center">STVQA                     | <div align="center">43K    |
| <div align="center">MMC-INST                  | <div align="center">500K   |
| <div align="center">MathV360K                 | <div align="center">338K   |
| <div align="center">MMC-Alignment             | <div align="center">250K   |
| <div align="center">DocReason                 | <div align="center">26K    |
| <div align="center">ALLaVA                    | <div align="center">1.7M   |
| <div align="center">Cocotext                  | <div align="center">163K   |
| <div align="center">Docvqa                    | <div align="center">16K    |
| <div align="center">Geoqa+                    | <div align="center">72K    |
| <div align="center">DocDownstream             | <div align="center">700K   |
| <div align="center">Cambrian                  | <div align="center">8.3M   |
| <div align="center">DocStruct4M               | <div align="center">4M     |
| <div align="center">LLaVA-onevision           | <div align="center">4M     |
| <div align="center">Docmatix                  | <div align="center">1.2M   |
| <div align="center">Infinity-Instruct         |  <div align="center">7M    |
| <div align="center">Our Synthetic Data        | <div align="center">0.8M   |


## **Model**
Our **[Aquila-VL-2B]** model, a VLM with 2-billion-parameter, achieve state-of-the-art(SOTA) performance among models of the same scale.



## **Citation**
If you find this dataset useful, please cite the following work
```
@misc{gu2024infinitymmscalingmultimodalperformance,
      title={Infinity-MM: Scaling Multimodal Performance with Large-Scale and High-Quality Instruction Data}, 
      author={Shuhao Gu and Jialing Zhang and Siyuan Zhou and Kevin Yu and Zhaohu Xing and Liangdong Wang and Zhou Cao and Jintao Jia and Zhuoyi Zhang and Yixuan Wang and Zhenchong Hu and Bo-Wen Zhang and Jijie Li and Dong Liang and Yingli Zhao and Yulong Ao and Yaoqi Liu and Fangxiang Feng and Guang Liu},
      year={2024},
      eprint={2410.18558},
      archivePrefix={arXiv},
      primaryClass={cs.CL},
      url={https://arxiv.org/abs/2410.18558}, 
}
```



[Ram++]: https://github.com/xinyu1205/recognize-anything?tab=readme-ov-file
[Qwen2-VL-2B]: https://huggingface.co/Qwen/Qwen2-VL-2B-Instruct
[Aquila-VL-2B]: https://huggingface.co/BAAI/Aquila-VL-2B-llava-qwen